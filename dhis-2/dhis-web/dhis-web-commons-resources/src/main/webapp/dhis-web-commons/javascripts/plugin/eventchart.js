Ext.onReady(function(){Ext.Ajax.method="GET";Ext.isIE=function(){return/trident/.test(Ext.userAgent)}();EV={};EV.instances=[];EV.i18n={};EV.isDebug=false;EV.isSessionStorage=("sessionStorage" in window&&window.sessionStorage!==null);EV.getCore=function(n){var j={},l={},k={},h={},i={},m;(function(){j.finals={dimension:{data:{value:"data",name:EV.i18n.data,dimensionName:"dx",objectName:"dx",warning:{filter:"..."}},category:{name:EV.i18n.categories,dimensionName:"co",objectName:"co"},indicator:{value:"indicators",name:EV.i18n.indicators,dimensionName:"dx",objectName:"in"},dataElement:{value:"dataElements",name:EV.i18n.data_elements,dimensionName:"dx",objectName:"de"},operand:{value:"operand",name:"Operand",dimensionName:"dx",objectName:"dc"},dataSet:{value:"dataSets",name:EV.i18n.data_sets,dimensionName:"dx",objectName:"ds"},period:{value:"period",name:EV.i18n.periods,dimensionName:"pe",objectName:"pe"},fixedPeriod:{value:"periods"},relativePeriod:{value:"relativePeriods",name:EV.i18n.relative_periods},startEndDate:{value:"dates",name:EV.i18n.start_end_dates},organisationUnit:{value:"organisationUnits",name:EV.i18n.organisation_units,dimensionName:"ou",objectName:"ou"},dimension:{value:"dimension"},value:{value:"value"}},chart:{series:"series",category:"category",filter:"filter",column:"column",stackedcolumn:"stackedcolumn",bar:"bar",stackedbar:"stackedbar",line:"line",area:"area",pie:"pie",radar:"radar"},data:{domain:"domain_",targetLine:"targetline_",baseLine:"baseline_",trendLine:"trendline_"},image:{png:"png",pdf:"pdf"},cmd:{init:"init_",none:"none_",urlparam:"id"},root:{id:"root"}};m=j.finals.dimension;m.objectNameMap={};m.objectNameMap[m.data.objectName]=m.data;m.objectNameMap[m.indicator.objectName]=m.indicator;m.objectNameMap[m.dataElement.objectName]=m.dataElement;m.objectNameMap[m.operand.objectName]=m.operand;m.objectNameMap[m.dataSet.objectName]=m.dataSet;m.objectNameMap[m.category.objectName]=m.category;m.objectNameMap[m.period.objectName]=m.period;m.objectNameMap[m.organisationUnit.objectName]=m.organisationUnit;m.objectNameMap[m.dimension.objectName]=m.dimension;j.period={periodTypes:[{id:"Daily",name:EV.i18n.daily},{id:"Weekly",name:EV.i18n.weekly},{id:"Monthly",name:EV.i18n.monthly},{id:"BiMonthly",name:EV.i18n.bimonthly},{id:"Quarterly",name:EV.i18n.quarterly},{id:"SixMonthly",name:EV.i18n.sixmonthly},{id:"Yearly",name:EV.i18n.yearly},{id:"FinancialOct",name:EV.i18n.financial_oct},{id:"FinancialJuly",name:EV.i18n.financial_july},{id:"FinancialApril",name:EV.i18n.financial_april}]};j.layout={west_width:452,west_fill:2,west_fill_accordion_indicator:56,west_fill_accordion_dataelement:59,west_fill_accordion_dataset:31,west_fill_accordion_period:307,west_fill_accordion_organisationunit:58,west_maxheight_accordion_indicator:450,west_maxheight_accordion_dataset:350,west_maxheight_accordion_period:405,west_maxheight_accordion_organisationunit:500,west_scrollbarheight_accordion_indicator:300,west_scrollbarheight_accordion_dataset:250,west_scrollbarheight_accordion_period:405,west_scrollbarheight_accordion_organisationunit:350,east_tbar_height:31,east_gridcolumn_height:30,form_label_width:55,window_favorite_ypos:100,window_confirm_width:250,window_share_width:500,grid_favorite_width:420,grid_row_height:27,treepanel_minheight:135,treepanel_maxheight:400,treepanel_fill_default:310,treepanel_toolbar_menu_width_group:140,treepanel_toolbar_menu_width_level:120,multiselect_minheight:100,multiselect_maxheight:250,multiselect_fill_default:345,multiselect_fill_reportingrates:315};j.chart={style:{inset:30,fontFamily:"Arial,Sans-serif,Lucida Grande,Ubuntu"},theme:{dv1:["#94ae0a","#1d5991","#a61120","#ff8809","#7c7474","#a61187","#ffd13e","#24ad9a","#a66111","#414141","#4500c4","#1d5700"]}};j.url={analysisFields:["*","program[id,name]","programStage[id,name]","columns[dimension,filter,items[id,"+n.namePropertyUrl+"]]","rows[dimension,filter,items[id,"+n.namePropertyUrl+"]]","filters[dimension,filter,items[id,"+n.namePropertyUrl+"]]","!lastUpdated","!href","!created","!publicAccess","!rewindRelativePeriods","!userOrganisationUnit","!userOrganisationUnitChildren","!userOrganisationUnitGrandChildren","!externalAccess","!access","!relativePeriods","!columnDimensions","!rowDimensions","!filterDimensions","!user","!organisationUnitGroups","!itemOrganisationUnitGroups","!userGroupAccesses","!indicators","!dataElements","!dataElementOperands","!dataElementGroups","!dataSets","!periods","!organisationUnitLevels","!organisationUnits"]}}());(function(){l.layout={};l.layout.Record=function(o){var o=Ext.clone(o);return function(){if(!Ext.isObject(o)){console.log("Record: config is not an object: "+o);return}if(!Ext.isString(o.id)){alert("Record: id is not text: "+o);return}return o}()};l.layout.Dimension=function(o){var o=Ext.clone(o);return function(){if(!Ext.isObject(o)){console.log("Dimension: config is not an object: "+o);return}if(!Ext.isString(o.dimension)){console.log("Dimension: name is not a string: "+o);return}if(o.dimension!==j.finals.dimension.category.objectName){var p=[]}return o}()};l.layout.Layout=function(p){var p=Ext.clone(p),q={},o,r;o=function(t){var t=Ext.clone(t);if(!(t&&Ext.isArray(t)&&t.length)){return}for(var s=0;s<t.length;s++){t[s]=l.layout.Dimension(t[s])}t=Ext.Array.clean(t);return t.length?t:null};r=function(){var u=j.finals.dimension,t,v={};if(!q){return}t=Ext.Array.clean([].concat(q.columns||[],q.rows||[],q.filters||[]));for(var s=0;s<t.length;s++){v[t[s].dimension]=t[s]}if(q.filters&&q.filters.length){for(var s=0;s<q.filters.length;s++){if(q.filters[s].dimension===u.indicator.objectName){i.message.alert(EV.i18n.indicators_cannot_be_specified_as_filter||"Indicators cannot be specified as filter");return}if(q.filters[s].dimension===u.category.objectName){i.message.alert(EV.i18n.categories_cannot_be_specified_as_filter||"Categories cannot be specified as filter");return}if(q.filters[s].dimension===u.dataSet.objectName){i.message.alert(EV.i18n.data_sets_cannot_be_specified_as_filter||"Data sets cannot be specified as filter");return}}}if(v[u.operand.objectName]&&v[u.indicator.objectName]){i.message.alert("Indicators and detailed data elements cannot be specified together");return}if(v[u.operand.objectName]&&v[u.dataElement.objectName]){i.message.alert("Detailed data elements and totals cannot be specified together");return}if(v[u.operand.objectName]&&v[u.dataSet.objectName]){i.message.alert("Data sets and detailed data elements cannot be specified together");return}if(v[u.operand.objectName]&&v[u.category.objectName]){i.message.alert("Categories and detailed data elements cannot be specified together");return}return true};return function(){var s=[],u=j.finals.dimension;if(!(p&&Ext.isObject(p))){console.log("Layout: config is not an object ("+n.el+")");return}for(var t=0,v=Ext.Array.clean([].concat(p.columns||[],p.rows||[],p.filters||[]));t<v.length;t++){if(l.layout.Dimension(v[t])){s.push(v[t].dimension)}}if(!Ext.Array.contains(s,"pe")&&!(p.startDate&&p.endDate)){alert("At least one fixed period, one relative period or start/end dates must be specified");return}p.columns=o(p.columns);p.rows=o(p.rows);p.filters=o(p.filters);if(!p.columns){alert("No series items selected");return}if(p.columns.length>1){p.filters=p.filters||[];p.filters=p.filters.concat(p.columns.splice(1))}if(!p.rows){alert("No category items selected");return}if(p.rows.length>1){p.filters=p.filters||[];p.filters=p.filters.concat(p.rows.splice(1))}if(p.id){q.id=p.id}if(p.name){q.name=p.name}q.columns=p.columns;q.rows=p.rows;q.filters=p.filters;q.type=Ext.isString(p.type)?p.type:"column";q.program=p.program;q.programStage=p.programStage;if(p.startDate&&p.endDate){q.startDate=p.startDate.substr(0,10);q.endDate=p.endDate.substr(0,10)}q.showValues=Ext.isBoolean(p.showData)?p.showData:(Ext.isBoolean(p.showValues)?p.showValues:true);q.hideEmptyRows=Ext.isBoolean(p.hideEmptyRows)?p.hideEmptyRows:(Ext.isBoolean(p.hideEmptyRows)?p.hideEmptyRows:true);q.showTrendLine=Ext.isBoolean(p.regression)?p.regression:(Ext.isBoolean(p.showTrendLine)?p.showTrendLine:false);q.targetLineValue=Ext.isNumber(p.targetLineValue)?p.targetLineValue:null;q.targetLineTitle=Ext.isString(p.targetLineLabel)&&!Ext.isEmpty(p.targetLineLabel)?p.targetLineLabel:(Ext.isString(p.targetLineTitle)&&!Ext.isEmpty(p.targetLineTitle)?p.targetLineTitle:null);q.baseLineValue=Ext.isNumber(p.baseLineValue)?p.baseLineValue:null;q.baseLineTitle=Ext.isString(p.baseLineLabel)&&!Ext.isEmpty(p.baseLineLabel)?p.baseLineLabel:(Ext.isString(p.baseLineTitle)&&!Ext.isEmpty(p.baseLineTitle)?p.baseLineTitle:null);q.sortOrder=Ext.isNumber(p.sortOrder)?p.sortOrder:0;q.rangeAxisMaxValue=Ext.isNumber(p.rangeAxisMaxValue)?p.rangeAxisMaxValue:null;q.rangeAxisMinValue=Ext.isNumber(p.rangeAxisMinValue)?p.rangeAxisMinValue:null;q.rangeAxisSteps=Ext.isNumber(p.rangeAxisSteps)?p.rangeAxisSteps:null;q.rangeAxisDecimals=Ext.isNumber(p.rangeAxisDecimals)?p.rangeAxisDecimals:null;q.rangeAxisTitle=Ext.isString(p.rangeAxisLabel)&&!Ext.isEmpty(p.rangeAxisLabel)?p.rangeAxisLabel:(Ext.isString(p.rangeAxisTitle)&&!Ext.isEmpty(p.rangeAxisTitle)?p.rangeAxisTitle:null);q.domainAxisTitle=Ext.isString(p.domainAxisLabel)&&!Ext.isEmpty(p.domainAxisLabel)?p.domainAxisLabel:(Ext.isString(p.domainAxisTitle)&&!Ext.isEmpty(p.domainAxisTitle)?p.domainAxisTitle:null);q.hideLegend=Ext.isBoolean(p.hideLegend)?p.hideLegend:false;q.hideTitle=Ext.isBoolean(p.hideTitle)?p.hideTitle:false;q.title=Ext.isString(p.title)&&!Ext.isEmpty(p.title)?p.title:null;q.parentGraphMap=Ext.isObject(p.parentGraphMap)?p.parentGraphMap:null;q.legend=Ext.isObject(p.legend)?p.legend:null;if(!r()){return}return q}()};l.response={};l.response.Header=function(o){var o=Ext.clone(o);return function(){if(!Ext.isObject(o)){console.log("Header: config is not an object: "+o);return}if(!Ext.isString(o.name)){console.log("Header: name is not a string: "+o);return}if(!Ext.isBoolean(o.meta)){console.log("Header: meta is not boolean: "+o);return}return o}()};l.response.Response=function(o){var o=Ext.clone(o);return function(){if(!(o&&Ext.isObject(o))){console.log("Response: config is not an object");return}if(!(o.headers&&Ext.isArray(o.headers))){console.log("Response: headers is not an array");return}for(var p=0,q;p<o.headers.length;p++){o.headers[p]=l.response.Header(o.headers[p])}o.headers=Ext.Array.clean(o.headers);if(!o.headers.length){console.log("Response: no valid headers");return}if(!(Ext.isArray(o.rows)&&o.rows.length>0)){alert("No values found");return}if(o.headers.length!==o.rows[0].length){console.log("Response: headers.length !== rows[0].length")}return o}()}}());(function(){k.prototype={};k.prototype.array={};k.prototype.array.getLength=function(p,o){if(!Ext.isArray(p)){if(!o){console.log("support.prototype.array.getLength: not an array")}return null}return p.length};k.prototype.array.sort=function(q,p,o){if(!k.prototype.array.getLength(q)){return}o=!!o||Ext.isNumber(o)?o:"name";q.sort(function(s,r){if(Ext.isObject(s)&&Ext.isObject(r)){s=s[o];r=r[o]}if(Ext.isArray(s)&&Ext.isArray(r)){s=s[o];r=r[o]}if(Ext.isString(s)&&Ext.isString(r)){s=s.toLowerCase();r=r.toLowerCase();if(p==="DESC"){return s<r?1:(s>r?-1:0)}else{return s<r?-1:(s>r?1:0)}}else{if(Ext.isNumber(s)&&Ext.isNumber(r)){return p==="DESC"?r-s:s-r}}return -1});return q};k.prototype.array.uniqueByProperty=function(t,r){var s=[],o=[];for(var p=0,q;p<t.length;p++){q=t[p];if(!Ext.Array.contains(s,q[r])){o.push(q);s.push(q[r])}}return o};k.prototype.array.getObjectMap=function(v,q,p,u){if(!(Ext.isArray(v)&&v.length)){return{}}var t={};q=q||"id";p=p||"name";u=u||"";for(var r=0,s;r<v.length;r++){s=v[r];t[u+s[q]]=s[p]}return t};k.prototype.object={};k.prototype.object.getLength=function(o,r){if(!Ext.isObject(o)){if(!r){console.log("support.prototype.object.getLength: not an object")}return null}var q=0;for(var p in o){if(o.hasOwnProperty(p)){q++}}return q};k.prototype.object.hasObject=function(p,s,r){if(!k.prototype.object.getLength(p)){return null}for(var q in p){var o=p[q];if(p.hasOwnProperty(q)&&o[s]===r){return true}}return null};k.prototype.str={};k.prototype.str.replaceAll=function(o,r,q){if(Ext.isString(o)){o=o.split(r).join(q)}else{if(Ext.isArray(o)){for(var p=0;p<o.length;p++){o[p]=o[p].split(r).join(q)}}}return o};k.prototype.str.toggleDirection=function(o){return o==="DESC"?"ASC":"DESC"};k.prototype.number={};k.prototype.number.getNumberOfDecimals=function(o){var p=new String(o);return(p.indexOf(".")>-1)?(p.length-p.indexOf(".")-1):0};k.prototype.number.roundIf=function(q,o){q=parseFloat(q);o=parseFloat(o);if(Ext.isNumber(q)&&Ext.isNumber(o)){var p=k.prototype.number.getNumberOfDecimals(q);return p>o?Ext.Number.toFixed(q,o):q}return q};k.prototype.number.prettyPrint=function(o,p){p=p||"space";if(p==="none"){return o}return o.toString().replace(/\B(?=(\d{3})+(?!\d))/g,j.report.digitGroupSeparator[p])};k.color={};k.color.hexToRgb=function(q){var p=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,o;q=q.replace(p,function(t,v,u,s){return v+v+u+u+s+s});o=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(q);return o?{r:parseInt(o[1],16),g:parseInt(o[2],16),b:parseInt(o[3],16)}:null}}());(function(){h.layout={};h.layout.cleanDimensionArray=function(p){if(!k.prototype.array.getLength(p)){return null}var q=[];for(var o=0;o<p.length;o++){q.push(l.layout.Dimension(p[o]))}q=Ext.Array.clean(q);return q.length?q:null};h.layout.sortDimensionArray=function(r,q){if(!k.prototype.array.getLength(r,true)){return null}r=h.layout.cleanDimensionArray(r);if(!r){console.log("service.layout.sortDimensionArray: no valid dimensions");return null}q=q||"dimensionName";Ext.Array.sort(r,function(t,s){if(t[q]<s[q]){return -1}if(t[q]>s[q]){return 1}return 0});for(var p=0,o;p<r.length;p++){k.prototype.array.sort(r[p].items,"ASC","id");if(k.prototype.array.getLength(r[p].ids)){k.prototype.array.sort(r[p].ids)}}return r};h.layout.getObjectNameDimensionMapFromDimensionArray=function(r){var q={};if(!k.prototype.array.getLength(r)){return null}for(var o=0,p;o<r.length;o++){p=l.layout.Dimension(r[o]);if(p){q[p.dimension]=p}}return k.prototype.object.getLength(q)?q:null};h.layout.getObjectNameDimensionItemsMapFromDimensionArray=function(r){var q={};if(!k.prototype.array.getLength(r)){return null}for(var o=0,p;o<r.length;o++){p=l.layout.Dimension(r[o]);if(p){q[p.dimension]=p.items}}return k.prototype.object.getLength(q)?q:null};h.layout.getItemName=function(v,s,r,o){var q=s.metaData,p="";if(h.layout.isHierarchy(v,s,r)){var w=q.names[r].split("/");w.shift();for(var u=0,t;u<w.length;u++){t=!!(u===w.length-1);p+=(o&&!t?'<span class="text-weak">':"")+w[u]+(o&&!t?"</span>":"")+(!t?" / ":"")}return p}p+=q.names[r];return p};h.layout.getExtendedLayout=function(t){var t=Ext.clone(t),v;v={columns:[],rows:[],filters:[],columnObjectNames:[],columnDimensionNames:[],rowObjectNames:[],rowDimensionNames:[],axisDimensions:[],axisObjectNames:[],axisDimensionNames:[],sortedAxisDimensionNames:[],filterDimensions:[],filterObjectNames:[],filterDimensionNames:[],sortedFilterDimensions:[],dimensions:[],objectNames:[],dimensionNames:[],objectNameDimensionsMap:{},objectNameItemsMap:{},objectNameIdsMap:{},dimensionNameDimensionsMap:{},dimensionNameItemsMap:{},dimensionNameIdsMap:{},dimensionNameSortedIdsMap:{}};Ext.applyIf(v,t);if(t.columns){for(var r=0,s,u,o;r<t.columns.length;r++){s=t.columns[r];u=s.items;o={};o.dimension=s.dimension;o.objectName=s.dimension;o.dimensionName=m.objectNameMap.hasOwnProperty(s.dimension)?m.objectNameMap[s.dimension].dimensionName||s.dimension:s.dimension;o.items=[];o.ids=[];if(u){o.items=u;for(var q=0;q<u.length;q++){o.ids.push(u[q].id)}}v.columns.push(o);v.columnObjectNames.push(o.objectName);v.columnDimensionNames.push(o.dimensionName);v.axisDimensions.push(o);v.axisObjectNames.push(o.objectName);v.axisDimensionNames.push(m.objectNameMap.hasOwnProperty(o.objectName)?m.objectNameMap[o.objectName].dimensionName||o.objectName:o.objectName);v.objectNameDimensionsMap[o.objectName]=o;v.objectNameItemsMap[o.objectName]=o.items;v.objectNameIdsMap[o.objectName]=o.ids}}if(t.rows){for(var r=0,s,u,o;r<t.rows.length;r++){s=Ext.clone(t.rows[r]);u=s.items;o={};o.dimension=s.dimension;o.objectName=s.dimension;o.dimensionName=m.objectNameMap.hasOwnProperty(s.dimension)?m.objectNameMap[s.dimension].dimensionName||s.dimension:s.dimension;o.items=[];o.ids=[];if(u){o.items=u;for(var q=0;q<u.length;q++){o.ids.push(u[q].id)}}v.rows.push(o);v.rowObjectNames.push(o.objectName);v.rowDimensionNames.push(o.dimensionName);v.axisDimensions.push(o);v.axisObjectNames.push(o.objectName);v.axisDimensionNames.push(m.objectNameMap.hasOwnProperty(o.objectName)?m.objectNameMap[o.objectName].dimensionName||o.objectName:o.objectName);v.objectNameDimensionsMap[o.objectName]=o;v.objectNameItemsMap[o.objectName]=o.items;v.objectNameIdsMap[o.objectName]=o.ids}}if(t.filters){for(var r=0,s,u,o;r<t.filters.length;r++){s=t.filters[r];u=s.items;o={};o.dimension=s.dimension;o.objectName=s.dimension;o.dimensionName=m.objectNameMap.hasOwnProperty(s.dimension)?m.objectNameMap[s.dimension].dimensionName||s.dimension:s.dimension;o.items=[];o.ids=[];if(u){o.items=u;for(var q=0;q<u.length;q++){o.ids.push(u[q].id)}}v.filters.push(o);v.filterDimensions.push(o);v.filterObjectNames.push(o.objectName);v.filterDimensionNames.push(m.objectNameMap.hasOwnProperty(o.objectName)?m.objectNameMap[o.objectName].dimensionName||o.objectName:o.objectName);v.objectNameDimensionsMap[o.objectName]=o;v.objectNameItemsMap[o.objectName]=o.items;v.objectNameIdsMap[o.objectName]=o.ids}}v.legendSet=t.legendSet?n.idLegendSetMap[t.legendSet.id]:null;if(t.legendSet&&t.legendSet.mapLegends){v.legendSet=n.idLegendSetMap[t.legendSet.id];k.prototype.array.sort(v.legendSet.mapLegends,"ASC","startValue")}v.axisDimensionNames=Ext.Array.unique(v.axisDimensionNames);v.filterDimensionNames=Ext.Array.unique(v.filterDimensionNames);v.columnDimensionNames=Ext.Array.unique(v.columnDimensionNames);v.rowDimensionNames=Ext.Array.unique(v.rowDimensionNames);v.filterDimensionNames=Ext.Array.unique(v.filterDimensionNames);v.sortedAxisDimensionNames=Ext.clone(v.axisDimensionNames).sort();v.sortedFilterDimensions=h.layout.sortDimensionArray(Ext.clone(v.filterDimensions));v.dimensions=[].concat(v.axisDimensions,v.filterDimensions);v.objectNames=[].concat(v.axisObjectNames,v.filterObjectNames);v.dimensionNames=[].concat(v.axisDimensionNames,v.filterDimensionNames);for(var r=0,p;r<v.dimensionNames.length;r++){p=v.dimensionNames[r];v.dimensionNameDimensionsMap[p]=[];v.dimensionNameItemsMap[p]=[];v.dimensionNameIdsMap[p]=[]}for(var r=0,o;r<v.dimensions.length;r++){o=v.dimensions[r];v.dimensionNameDimensionsMap[o.dimensionName].push(o);v.dimensionNameItemsMap[o.dimensionName]=v.dimensionNameItemsMap[o.dimensionName].concat(o.items);v.dimensionNameIdsMap[o.dimensionName]=v.dimensionNameIdsMap[o.dimensionName].concat(o.ids)}for(var w in v.dimensionNameIdsMap){if(v.dimensionNameIdsMap.hasOwnProperty(w)){v.dimensionNameSortedIdsMap[w]=Ext.clone(v.dimensionNameIdsMap[w]).sort()}}v.tableUuid=n.el+"_"+Ext.data.IdGenerator.get("uuid").generate();return v};h.layout.getSyncronizedXLayout=function(r,p,u){var s,t,q=Ext.Array.clean([].concat(p.columns||[],p.rows||[],p.filters||[])),v=Ext.Array.clean([].concat(r.columns||[],r.rows||[],r.filters||[])),o,r;s=function(x){var w;w=function(z){var A;z=Ext.clone(z);for(var y=0;y<z.length;y++){if(z[y].dimension===x){A=z[y]}}if(A){Ext.Array.remove(z,A)}return z};if(p.columns){p.columns=w(p.columns)}if(p.rows){p.rows=w(p.rows)}if(p.filters){p.filters=w(p.filters)}};t=function(){var x=[];for(var w=0;w<u.headers.length;w++){x.push(u.headers[w].name)}return x};o=function(w){var x=w.columns[0].ids.length*w.rows[0].ids.length,y="This chart is potentially very large due to the high number of series and category items. Create the chart anyway?";if(x>200){if(!confirm(y)){return null}}return w};return function(){for(var A=0,D,C;A<q.length;A++){D=q[A];D.items=[];C=u.nameHeaderMap[D.dimension];if(C){for(var z=0,w;z<C.ids.length;z++){w=C.ids[z];D.items.push({id:w,name:u.metaData.names[w]||w})}}}for(var A=0,F;A<v.length;A++){F=v[A];if(Ext.isString(F.filter)){var G=F.filter.split(":");if(G[0]==="IN"&&G.length>1&&Ext.isString(G[1])){var I=G[1].split(";"),E=[];for(var z=0,D;z<q.length;z++){D=q[z];if(D.dimension===F.dimension&&D.items&&D.items.length){var E=[];for(var y=0,B;y<I.length;y++){B=I[y];for(var x=0,H;x<D.items.length;x++){H=D.items[x];if(H.name===B){E.push(H)}}}D.items=E}}}}}r=l.layout.Layout(p);if(!r){return null}p=h.layout.getExtendedLayout(r);p=o(p);if(!p){return null}return p}()};h.layout.getExtendedAxis=function(z,Y){var t,r,A=[],y=1,I,q,E=[],X=[],s=[],D=[],w=[],x=[],M=[],u={};if(Y==="col"){t=Ext.clone(z.columnDimensionNames);r="colSpan"}else{if(Y==="row"){t=Ext.clone(z.rowDimensionNames);r="rowSpan"}}if(!(Ext.isArray(t)&&t.length)){return}for(var T=0;T<t.length;T++){A.push({dimensionName:t[T]})}q=function(){var Z=[];for(var aa=0;aa<A.length;aa++){Z.push(z.dimensionNameIdsMap[A[aa].dimensionName])}return Z}();I=q.length;for(var T=0,K;T<I;T++){K=q[T].length;E.push(K);y=y*K;X.push(y)}for(var T=0;T<I;T++){if(E[T]===1){if(T===0){s.push(y)}else{if(z.hideEmptyRows&&Y==="row"){s.push(y/X[T])}else{s.push(s[0])}}}else{s.push(y/X[T])}}D.push(q[0]);if(I.length>1){for(var T=1,V,N;T<I;T++){V=[];N=E[T]===1?E[0]:X[T-1];for(var R=0;R<N;R++){V=V.concat(q[T])}D.push(V)}}for(var T=0,v,O,B,S;T<I;T++){v=[];O=q[T];B=s[T];S=y/(B*O.length);for(var R=0;R<S;R++){for(var Q=0;Q<O.length;Q++){for(var P=0;P<B;P++){v.push(O[Q])}}}w.push(v)}for(var T=0,H;T<y;T++){H="";for(var R=0;R<I;R++){H+=w[R][T]}if(H){x.push(H)}}for(var T=0,F;T<w.length;T++){F=[];for(var R=0,p;R<w[T].length;R++){p={id:w[T][R],uuid:Ext.data.IdGenerator.get("uuid").generate(),dim:T,axis:Y};if(T===w.length-1){p.leaf=true}F.push(p)}M.push(F)}for(var T=0;T<M.length;T++){for(var R=0,p,W=0,o;R<M[T].length;R++){p=M[T][R];if(W===0){p[r]=s[T];p.children=p.leaf?0:s[T];p.oldest=true;if(T===0){p.root=true}o=p}p.oldestSibling=o;if(++W===s[T]){W=0}}}if(I>1){for(var T=1,F;T<I;T++){F=M[T];for(var R=0,W=0,B=s[T-1];R<F.length;R++){F[R].parent=M[T-1][R]}}}if(M.length){var B=I>1?k.prototype.array.sort(Ext.clone(s))[1]:y,J=M[M.length-1];for(var T=0,U,C,p,G=[];T<J.length;T++){U=J[T];G.push(U.uuid);C=[];p=U;while(p.parent){p=p.parent;C.push(p.oldestSibling.uuid)}U.uuids=Ext.clone(C);if(G.length===B){for(var R=(T-B)+1,U;R<=T;R++){U=J[R];U.uuids=U.uuids.concat(Ext.clone(G))}G=[]}}}for(var T=0;T<M.length;T++){for(var R=0,L;R<M[T].length;R++){L=M[T][R];u[L.uuid]=L}}return{type:Y,items:A,xItems:{unique:q,gui:D,all:w},objects:{all:M},ids:x,span:s,dims:I,size:y,uuidObjectMap:u}};h.layout.isHierarchy=function(p,o,q){return p.showHierarchy&&Ext.isObject(o.metaData.ouHierarchy)&&o.metaData.ouHierarchy.hasOwnProperty(q)};h.layout.getHierarchyName=function(s,t,u){var r=s[u],q=Ext.Array.clean(r.split("/")),o="";if(q.length<2){return t[u]}for(var p=0;p<q.length;p++){o+=t[q[p]]+" / "}o+=t[u];return o};h.layout.layout2plugin=function(t,q){var t=Ext.clone(t),s=Ext.Array.clean([].concat(t.columns||[],t.rows||[],t.filters||[]));t.url=n.contextPath;if(q){t.el=q}if(Ext.isString(t.id)){return{id:t.id}}for(var p=0,u,r;p<s.length;p++){u=s[p];delete u.id;delete u.ids;delete u.type;delete u.dimensionName;delete u.objectName;for(var o=0,r;o<u.items.length;o++){r=u.items[o];delete r.name;delete r.code;delete r.created;delete r.lastUpdated;delete r.value}}if(t.showTotals){delete t.showTotals}if(t.showSubTotals){delete t.showSubTotals}if(!t.hideEmptyRows){delete t.hideEmptyRows}if(!t.showHierarchy){delete t.showHierarchy}if(t.displayDensity==="normal"){delete t.displayDensity}if(t.fontSize==="normal"){delete t.fontSize}if(t.digitGroupSeparator==="space"){delete t.digitGroupSeparator}if(!t.legendSet){delete t.legendSet}if(!t.sorting){delete t.sorting}delete t.parentGraphMap;delete t.reportingPeriod;delete t.organisationUnit;delete t.parentOrganisationUnit;delete t.regression;delete t.cumulative;delete t.topLimit;return t};h.layout.getDataDimensionsFromLayout=function(s){var r=Ext.Array.clean([].concat(s.columns||[],s.rows||[],s.filters||[])),q=["pe","ou"],o=[];for(var p=0;p<r.length;p++){if(!Ext.Array.contains(q,r[p].dimension)){o.push(r[p])}}return o};h.response={};h.response.aggregate={};h.response.aggregate.getExtendedResponse=function(z,p){var J="[N/A]",x=["ou","pe"],D,y,q;p=Ext.clone(p);q=p.headers;D=p.metaData.ouHierarchy,y=p.metaData.names;y[J]=J;p.metaData.optionNames={};p.nameHeaderMap={};p.idValueMap={};for(var H=0,G,A;H<q.length;H++){G=q[H];G.ids=[];A=Ext.Array.contains(x,G.name);if(G.meta){if(G.type==="java.lang.Double"){var o=[];for(var F=0,C,s,t,B;F<p.rows.length;F++){C=p.rows[F][H]||J;s=G.name+C;t=parseFloat(C);B=Ext.isNumber(t)?t:(y[C]||C);y[s]=(A?"":G.column+" ")+B;p.rows[F][H]=s;o.push({id:s,sortingId:Ext.isNumber(t)?t:Number.MAX_VALUE})}k.prototype.array.sort(o,"ASC","sortingId");G.ids=Ext.Array.pluck(o,"id")}else{var o=[];for(var F=0,C,s,K,r;F<p.rows.length;F++){C=p.rows[F][H]||J;s=G.name+C;r=h.layout.isHierarchy(z,p,C);K=A?"":G.column+" ";K=r?h.layout.getHierarchyName(D,y,C):(y[C]||C);y[s]=K;p.rows[F][H]=s;if(r){D[s]=D[C]}o.push({id:s,sortingId:G.name==="pe"?s:K})}k.prototype.array.sort(o,"ASC","sortingId");G.ids=Ext.Array.pluck(o,"id")}}G.ids=Ext.Array.unique(G.ids);G.size=G.ids.length;G.index=H;p.nameHeaderMap[G.name]=G}var E=p.nameHeaderMap[j.finals.dimension.value.value].index,w=m.data.dimensionName,v=z.axisDimensionNames,I=[];for(var H=0;H<v.length;H++){I.push(p.nameHeaderMap[v[H]].index)}for(var H=0,u,C;H<p.rows.length;H++){u=p.rows[H];C="";for(var F=0;F<I.length;F++){C+=u[I[F]]}p.idValueMap[C]=u[E]}return p}}());(function(){i.mask={};i.mask.show=function(o,p){if(!Ext.isObject(o)){console.log("web.mask.show: component not an object");return null}p=p||"Loading..";if(o.mask&&o.mask.destroy){o.mask.destroy();o.mask=null}o.mask=new Ext.create("Ext.LoadMask",o,{shadow:false,msg:p,style:"box-shadow:0",bodyStyle:"box-shadow:0"});o.mask.show()};i.mask.hide=function(o){if(!Ext.isObject(o)){console.log("support.gui.mask.hide: component not an object");return null}if(o.mask&&o.mask.destroy){o.mask.destroy();o.mask=null}};i.message={};i.message.alert=function(o){console.log(o)};i.analytics={};i.analytics.getParamString=function(u,w){var q,o=Ext.Array.clean([].concat(u.columns||[],u.rows||[])),v=["longitude","latitude"],p;q="/api/analytics/events/aggregate/"+u.program.id+"."+(w||"json")+"?";q+="stage="+u.programStage.id;if(o){for(var s=0,t;s<o.length;s++){t=o[s];if(Ext.Array.contains(v,t.dimension)||(t.dimension==="pe"&&!t.items&&!t.filter)){continue}q+="&dimension="+t.dimension;if(t.items&&t.items.length){q+=":";for(var r=0,x;r<t.items.length;r++){x=t.items[r];q+=encodeURIComponent(x.id)+((r<(t.items.length-1))?";":"")}}else{q+=t.filter?":"+encodeURIComponent(t.filter):""}}}if(u.filters){for(var s=0,t;s<u.filters.length;s++){t=u.filters[s];q+="&filter="+t.dimension;if(Ext.isArray(t.items)&&t.items.length){q+=":";for(var r=0;r<t.items.length;r++){q+=encodeURIComponent(t.items[r].id);q+=r<t.items.length-1?";":""}}else{q+=t.filter?":"+encodeURIComponent(t.filter):""}}}if(u.startDate&&u.endDate){q+="&startDate="+u.startDate+"&endDate="+u.endDate}q+="&displayProperty="+n.userAccount.settings.keyAnalysisDisplayProperty.toUpperCase();return q};i.analytics.validateUrl=function(p){var q;if(Ext.isIE){q="Too many items selected (url has "+p.length+" characters). Internet Explorer accepts maximum 2048 characters."}else{var o=p.length>8000?"8000":(p.length>4000?"4000":"2000");q="Too many items selected (url has "+p.length+" characters). Please reduce to less than "+o+" characters."}q+="\n\nHint: A good way to reduce the number of items is to use relative periods and level/group organisation unit selection modes.";alert(q)};i.report={};i.report.aggregate={};i.report.aggregate.sort=function(v,A,p){var u=v.sorting.id,q=v.rows[0].dimension,o=A.nameHeaderMap[q].ids,r=A.idValueMap,w=v.sorting?v.sorting.direction:"DESC",z=[],t;if(Ext.isString(u)){u=u.toLowerCase()==="total"?"total_":u}else{if(Ext.isNumber(u)){if(u===0){u="total_"}else{u=p.ids[parseInt(u)-1]}}else{return A}}for(var s=0,y,x;s<o.length;s++){y=u+o[s];x=parseFloat(r[y]);z.push({id:o[s],value:Ext.isNumber(x)?x:(Number.MAX_VALUE*-1)})}k.prototype.array.sort(z,w,"value");A.nameHeaderMap[q].ids=Ext.Array.pluck(z,"id");return A};i.report.aggregate.createChart=function(P,I,x,p){var q=I.columnDimensionNames[0]?I.dimensionNameIdsMap[I.columnDimensionNames[0]]:[],A=[],F={},L=function(){for(var T=0,U;T<q.length;T++){U=Ext.data.IdGenerator.get("uuid").generate();A.push(U);F[U]=q[T];x.metaData.names[U]=x.metaData.names[q[T]]}}(),t=I.rowDimensionNames[0]?I.dimensionNameIdsMap[I.rowDimensionNames[0]]:[],G=function(){var U=[];if(I.filters){for(var T=0;T<I.filters.length;T++){U=U.concat(I.filters[T].ids||[])}}return U}(),z=Ext.data.IdGenerator.get("uuid").generate(),y=function(X,V){for(var U=0,Y,W;U<X.length;U++){Y=X[U];W=0;for(var T=0;T<V.length;T++){W+=parseFloat(Y[V[T]]);Y[z]=W}}},C,u,K,v,Q,S,r,B,O,J,R,w,H,s,N,M,E,D,o={};v=function(ag){var ac=[],ai=[],af=[],X=[],ah;for(var ad=0,ab,V,aj,aa;ad<t.length;ad++){ab={};V=t[ad];aj=[];aa=false;ab[j.finals.data.domain]=x.metaData.names[V];for(var Z=0,U,ae;Z<q.length;Z++){U=k.prototype.str.replaceAll(q[Z],"#","")+k.prototype.str.replaceAll(t[ad],"#","");ae=x.idValueMap[U];aj.push(ae);ab[A[Z]]=ae?parseFloat(ae):"0.0"}aa=!(Ext.Array.clean(aj).length);if(!(aa&&I.hideEmptyRows)){ac.push(ab)}}if(ag){y(ac,A)}if(I.sortOrder){var Y=ag?z:A[0];k.prototype.array.sort(ac,I.sortOrder===-1?"ASC":"DESC",Y)}if(I.showTrendLine){var W,T;if(ag){W=new SimpleRegression();T=j.finals.data.trendLine+z;for(var ad=0,ae;ad<ac.length;ad++){ae=ac[ad][z];W.addData(ad,parseFloat(ae))}for(var ad=0;ad<ac.length;ad++){ac[ad][T]=parseFloat(W.predict(ad).toFixed(1))}ai.push(T);x.metaData.names[T]=EV.i18n.trend+" (Total)"}else{for(var ad=0;ad<A.length;ad++){W=new SimpleRegression();T=j.finals.data.trendLine+A[ad];for(var Z=0,ae;Z<ac.length;Z++){ae=ac[Z][A[ad]];W.addData(Z,parseFloat(ae))}for(var Z=0;Z<ac.length;Z++){ac[Z][T]=parseFloat(W.predict(Z).toFixed(1))}ai.push(T);x.metaData.names[T]=EV.i18n.trend+" ("+x.metaData.names[A[ad]]+")"}}}if(Ext.isNumber(I.targetLineValue)||Ext.isNumber(parseFloat(I.targetLineValue))){for(var ad=0;ad<ac.length;ad++){ac[ad][j.finals.data.targetLine]=parseFloat(I.targetLineValue)}af.push(j.finals.data.targetLine)}if(Ext.isNumber(I.baseLineValue)||Ext.isNumber(parseFloat(I.baseLineValue))){for(var ad=0;ad<ac.length;ad++){ac[ad][j.finals.data.baseLine]=parseFloat(I.baseLineValue)}X.push(j.finals.data.baseLine)}ah=Ext.create("Ext.data.Store",{fields:function(){var ak=Ext.clone(A);ak.push(j.finals.data.domain);ak=ak.concat(ai,af,X);return ak}(),data:ac});ah.rangeFields=A;ah.domainFields=[j.finals.data.domain];ah.trendLineFields=ai;ah.targetLineFields=af;ah.baseLineFields=X;ah.numericFields=[].concat(ah.rangeFields,ah.trendLineFields,ah.targetLineFields,ah.baseLineFields);ah.getMaximum=function(){var al=[];for(var ak=0;ak<ah.numericFields.length;ak++){al.push(ah.max(ah.numericFields[ak]))}return Ext.Array.max(al)};ah.getMinimum=function(){var al=[];for(var ak=0;ak<ah.numericFields.length;ak++){al.push(ah.min(ah.numericFields[ak]))}return Ext.Array.min(al)};ah.getMaximumSum=function(){var al=[],ak=0;ah.each(function(am){ak=0;for(var an=0;an<ah.rangeFields.length;an++){ak+=am.data[ah.rangeFields[an]]}al.push(ak)});return Ext.Array.max(al)};ah.hasDecimals=function(){var ak=ah.getRange();for(var am=0;am<ak.length;am++){for(var al=0,an;al<ah.rangeFields.length;al++){an=ak[am].data[ah.rangeFields[al]];if(Ext.isNumber(an)&&(an%1)){return true}}}return false};ah.getNumberOfDecimals=function(){var al=ah.getRange(),ak=[];for(var an=0;an<al.length;an++){for(var am=0,ao;am<ah.rangeFields.length;am++){ao=al[an].data[ah.rangeFields[am]];if(Ext.isNumber(ao)&&(ao%1)){ao=ao.toString();ak.push(ao.length-ao.indexOf(".")-1)}}}return Ext.Array.max(ak)};if(EV.isDebug){console.log("store",ah);console.log("data",ac);console.log("rangeFields",ah.rangeFields);console.log("domainFields",ah.domainFields);console.log("trendLineFields",ah.trendLineFields);console.log("targetLineFields",ah.targetLineFields);console.log("baseLineFields",ah.baseLineFields)}return ah};Q=function(W){var V=j.finals.chart,Y=W.getMinimum(),Z,U,X;getRenderer=function(aa){var ac="0.";for(var ab=0;ab<aa;ab++){ac+="0"}return ac};if((I.type===V.stackedcolumn||I.type===V.stackedbar)&&(I.showTrendLine||I.targetLineValue||I.baseLineValue)){var T=[W.getMaximum(),W.getMaximumSum()];Z=Math.ceil(Ext.Array.max(T)*1.1);Z=Math.floor(Z/10)*10}U=W.getNumberOfDecimals();renderer=!!U&&(W.getMaximum()<20)?getRenderer(U):"0,0";X={type:"Numeric",position:"left",fields:W.numericFields,minimum:Y<0?Y:0,label:{renderer:Ext.util.Format.numberRenderer(renderer)},labelTitle:{font:"bold 13px "+j.chart.style.fontFamily},grid:{odd:{opacity:1,stroke:"#aaa","stroke-width":0.1},even:{opacity:1,stroke:"#aaa","stroke-width":0.1}}};if(Z){X.maximum=Z}if(I.rangeAxisMaxValue){X.maximum=I.rangeAxisMaxValue}if(I.rangeAxisMinValue){X.minimum=I.rangeAxisMinValue}if(I.rangeAxisSteps){X.majorTickSteps=I.rangeAxisSteps-1}if(I.rangeAxisDecimals){X.label.renderer=Ext.util.Format.numberRenderer(getRenderer(I.rangeAxisDecimals))}if(I.rangeAxisTitle){X.title=I.rangeAxisTitle}return X};S=function(T){var U={type:"Category",position:"bottom",fields:T.domainFields,label:{rotate:{degrees:320},style:{fontSize:"11px"}}};if(I.domainAxisTitle){U.title=I.domainAxisTitle;U.labelTitle={font:"bold 13px "+j.chart.style.fontFamily}}return U};r=function(U){var T=[];if(Ext.isObject(I.legend)&&Ext.isArray(I.legend.seriesNames)){return I.legend.seriesNames}else{for(var X=0,Z,W,V,Y;X<U.rangeFields.length;X++){Z=F[U.rangeFields[X]];W=x.metaData.optionNames[Z]||x.metaData.names[Z];if(Ext.isObject(I.legend)&&I.legend.maxLength){var V=parseInt(I.legend.maxLength);if(Ext.isNumber(V)){W=W.substr(0,V)+".."}}T.push(W)}}return T};B=function(U){var T={type:"column",axis:"left",xField:U.domainFields,yField:U.rangeFields,style:{opacity:0.8,lineWidth:3},markerConfig:{type:"circle",radius:4},tips:w(),title:r(U)};if(I.showValues){T.label={display:"outside","text-anchor":"middle",field:U.rangeFields,font:j.chart.style.fontFamily,renderer:function(V){return V==="0.0"?"":V}}}return T};O=function(U,X){var T=[];for(var V=0,W;V<U.trendLineFields.length;V++){W=X?"#000":j.chart.theme.dv1[V];T.push({type:"line",axis:"left",xField:U.domainFields,yField:U.trendLineFields[V],style:{opacity:0.8,lineWidth:2,"stroke-dasharray":14,stroke:W},markerConfig:{type:"circle",radius:0,fill:W},title:x.metaData.names[U.trendLineFields[V]]})}return T};J=function(T){return{type:"line",axis:"left",xField:T.domainFields,yField:T.targetLineFields,style:{opacity:1,lineWidth:1,"stroke-width":1,stroke:"#000"},showMarkers:false,title:(Ext.isString(I.targetLineTitle)?I.targetLineTitle:EV.i18n.target)+" ("+I.targetLineValue+")"}};R=function(T){return{type:"line",axis:"left",xField:T.domainFields,yField:T.baseLineFields,style:{opacity:1,lineWidth:1,"stroke-width":1,stroke:"#000"},showMarkers:false,title:(Ext.isString(I.baseLineTitle)?I.baseLineTitle:EV.i18n.base)+" ("+I.baseLineValue+")"}};w=function(){return{trackMouse:true,cls:"dv-chart-tips",renderer:function(T,U){if(U.value){var V=U.value[1]==="0.0"?"-":U.value[1];this.update('<div style="text-align:center"><div style="font-size:17px; font-weight:bold">'+V+'</div><div style="font-size:10px">'+T.data[j.finals.data.domain]+"</div></div>")}}}};H=function(U){var T=j.chart.theme.dv1.slice(0,U.rangeFields.length);Ext.chart.theme.dv1=Ext.extend(Ext.chart.theme.Base,{constructor:function(V){Ext.chart.theme.Base.prototype.constructor.call(this,Ext.apply({seriesThemes:T,colors:T},V))}})};s=function(ae){var aa=30,Z=7,af,ag=0,ab="",V,ad=false,Y="top",ah=12,ac=0,X=["top","right","bottom","left"];if(I.type===j.finals.chart.pie){af=ae.getCount();ae.each(function(ai){ab+=ai.data[ae.domainFields[0]]})}else{af=ae.rangeFields.length;for(var W=0,U,T;W<ae.rangeFields.length;W++){if(ae.rangeFields[W].indexOf("#")!==-1){T=ae.rangeFields[W].split("#");U=x.metaData.names[T[0]]+" "+x.metaData.names[T[1]]}else{U=x.metaData.names[ae.rangeFields[W]]}ab+=U}}ag=ab.length;V=(af*aa)+(ag*Z);if(V>p.getWidth()-50){ad=true;Y="right"}if(Y==="right"){ac=5}if(I.legend){if(Ext.Array.contains(X,I.legend.position)){Y=I.legend.position}ah=parseInt(I.legend.fontSize)||ah;ah=ah+"px"}return Ext.create("Ext.chart.Legend",{position:Y,isVertical:ad,labelFont:ah+" "+j.chart.style.fontFamily,boxStroke:"#ffffff",boxStrokeWidth:0,padding:ac})};N=function(ac){var ab=[],ag="",ai,Z=x.metaData.names,V={EQ:"=",GT:">",GE:">=",LT:"<",LE:"<=",NE:"!="};if(I.startDate&&I.endDate){ag=I.startDate+" - "+I.endDate}if(I.title){ag+=(ag.length?", ":"")+I.title}else{if(I.type===j.finals.chart.pie){var T=Ext.Array.clean([].concat(q||[]));if(Ext.isArray(T)&&T.length){for(var X=0;X<T.length;X++){ag+=x.metaData.names[T[X]];ag+=X<T.length-1?", ":""}}}else{var ah=["pe","ou"];if(P.filters){for(var X=0,Y;X<P.filters.length;X++){Y=P.filters[X];ag+=(ag.length?", ":"");if(Ext.Array.contains(ah,Y.dimension)){var T=x.metaData[Y.dimension],af="";for(var ae=0;ae<T.length;ae++){af+=(af.length?", ":"")+Z[T[ae]]}ag+=af}else{if(Y.filter){var ab=Y.filter.split(":");if(ab.length===2){var U=ab[0],aa=ab[1].split(";"),af="";if(U==="IN"){for(var ae=0;ae<aa.length;ae++){af+=(af.length?", ":"")+aa[ae]}ag+=af}else{ag+=Z[Y.dimension]+" "+V[U]+" "+ab[1]}}else{var W=[],ad=[],af="";for(var ae=0;ae<ab.length;ae++){if(ae%2){ad.push(ab[ae])}else{W.push(ab[ae])}}for(var ae=0;ae<W.length;ae++){af+=(af.length?", ":"")+Z[Y.dimension]+" "+(V[W[ae]]||"")+" "+ad[ae]}ag+=af}}else{ag+=Z[Y.dimension]}}}}}}ai=(p.getWidth()/ag.length)<11.6?13:18;return Ext.create("Ext.draw.Sprite",{type:"text",text:ag,font:"bold "+ai+"px "+j.chart.style.fontFamily,fill:"#111",height:20,y:20})};M=function(){return function(){this.animate=false;this.setWidth(p.getWidth()-15);this.setHeight(p.getHeight()-40);this.animate=true}};E=function(){return function(){if(this.items){var Y=this.items[0],Z=Ext.isIE?Y.el.dom.scrollWidth:Y.el.getWidth(),V=10,U=this.legend,X,T;if(this.legend.position==="top"){X=U.x+(U.width/2);T=Z?X-(Z/2):V}else{var W=U?U.width:0;T=Z?(this.width/2)-(Z/2):V}Y.setAttributes({x:T},true)}}};D=function(V){var W,U=V.store||{},T={animate:true,shadow:false,insetPadding:35,width:p.getWidth()-15,height:p.getHeight()-40,theme:"dv1"};if(!I.hideLegend){T.legend=s(U);if(T.legend.position==="right"){T.insetPadding=40}}if(!I.hideTitle){T.items=[N(U)]}else{T.insetPadding=10}Ext.apply(T,V);W=Ext.create("Ext.chart.Chart",T);W.setChartSize=M();W.setTitlePosition=E();W.onViewportResize=function(){W.setChartSize();W.redraw();W.setTitlePosition()};W.on("afterrender",function(){W.setTitlePosition()});return W};o.column=function(V){var T=v(V),Y=Q(T),X=S(T),W=[Y,X],U=[B(T)];if(I.showTrendLine){U=U.concat(O(T,V))}if(I.targetLineValue){U.push(J(T))}if(I.baseLineValue){U.push(R(T))}H(T,V);return D({store:T,axes:W,series:U})};o.stackedcolumn=function(){var U=this.column(true);for(var T=0,V;T<U.series.items.length;T++){V=U.series.items[T];if(V.type===j.finals.chart.column){V.stacked=true}}return U};o.bar=function(ab){var ac=v(ab),X=Q(ac),Y=S(ac),aa,W=B(ac),T,U,ad,Z;X.position="bottom";Y.position="left";Y.label.rotate.degrees=360;aa=[X,Y];W.type="bar";W.axis="bottom";if(I.showValues){W.label={display:"outside","text-anchor":"middle",field:ac.rangeFields}}W=[W];if(I.showTrendLine){T=O(ac,ab);for(var V=0;V<T.length;V++){T[V].axis="bottom";T[V].xField=ac.trendLineFields[V];T[V].yField=ac.domainFields}W=W.concat(T)}if(I.targetLineValue){U=J(ac);U.axis="bottom";U.xField=ac.targetLineFields;U.yField=ac.domainFields;W.push(U)}if(I.baseLineValue){ad=R(ac);ad.axis="bottom";ad.xField=ac.baseLineFields;ad.yField=ac.domainFields;W.push(ad)}H(ac);return D({store:ac,axes:aa,series:W})};o.stackedbar=function(){var U=this.bar(true);for(var T=0,V;T<U.series.items.length;T++){V=U.series.items[T];if(V.type===j.finals.chart.bar){V.stacked=true}}return U};o.line=function(){var aa=v(),W=Q(aa),X=S(aa),Y=[W,X],U=[],T=j.chart.theme.dv1.slice(0,aa.rangeFields.length),Z=r(aa);for(var V=0,ab;V<aa.rangeFields.length;V++){ab={type:"line",axis:"left",xField:aa.domainFields,yField:aa.rangeFields[V],style:{opacity:0.8,lineWidth:3},markerConfig:{type:"circle",radius:4},tips:w(),title:Z[V]};U.push(ab)}if(I.showTrendLine){U=O(aa).concat(U);T=T.concat(T)}if(I.targetLineValue){U.push(J(aa));T.push("#051a2e")}if(I.baseLineValue){U.push(R(aa));T.push("#051a2e")}Ext.chart.theme.dv1=Ext.extend(Ext.chart.theme.Base,{constructor:function(ac){Ext.chart.theme.Base.prototype.constructor.call(this,Ext.apply({seriesThemes:T,colors:T},ac))}});return D({store:aa,axes:Y,series:U})};o.area=function(){I.hideEmptyRows=true;var T=v(true),X=Q(T),W=S(T),V=[X,W],U=B(T);U.type="area";U.style.opacity=0.7;U.style.lineWidth=0;delete U.label;delete U.tips;U=[U];if(I.showTrendLine){U=U.concat(O(T,true))}if(I.targetLineValue){U.push(J(T))}if(I.baseLineValue){U.push(R(T))}H(T);return D({store:T,axes:V,series:U})};o.pie=function(){var U=v(),W,T,X,V={field:j.finals.data.domain};if(I.showValues){V.display="middle";V.contrast=true;V.font="14px "+j.chart.style.fontFamily;V.renderer=function(Z){var Y=U.getAt(U.findExact(j.finals.data.domain,Z));return Y.data[U.rangeFields[0]]}}W=[{type:"pie",field:U.rangeFields[0],donut:7,showInLegend:true,highlight:{segment:{margin:5}},label:V,style:{opacity:0.8,stroke:"#555"},tips:{trackMouse:true,cls:"dv-chart-tips",renderer:function(Y){this.update('<div style="text-align:center"><div style="font-size:17px; font-weight:bold">'+Y.data[U.rangeFields[0]]+'</div><div style="font-size:10px">'+Y.data[j.finals.data.domain]+"</div></div>")}}}];T=j.chart.theme.dv1.slice(0,x.nameHeaderMap[I.rowDimensionNames[0]].ids.length);Ext.chart.theme.dv1=Ext.extend(Ext.chart.theme.Base,{constructor:function(Y){Ext.chart.theme.Base.prototype.constructor.call(this,Ext.apply({seriesThemes:T,colors:T},Y))}});X=D({store:U,series:W});X.insetPadding=40;X.shadow=true;return X};o.radar=function(){var T=v(),Z=[],W=[],V=r(T),X;Z.push({type:"Radial",position:"radial",label:{display:true}});for(var U=0,Y;U<T.rangeFields.length;U++){Y={showInLegend:true,type:"radar",xField:T.domainFields,yField:T.rangeFields[U],style:{opacity:0.5},tips:w(),title:V[U]};if(I.showValues){Y.label={display:"over",field:T.rangeFields[U]}}W.push(Y)}X=D({store:T,axes:Z,series:W,theme:"Category2"});X.insetPadding=40;X.height=p.getHeight()-80;X.setChartSize=function(){this.animate=false;this.setWidth(p.getWidth());this.setHeight(p.getHeight()-80);this.animate=true};return X};return o[I.type]()}}());(function(){if(Ext.isArray(n.dimensions)){k.prototype.array.sort(n.dimensions);for(var o=0,p;o<n.dimensions.length;o++){p=n.dimensions[o];p.dimensionName=p.id;p.objectName=j.finals.dimension.dimension.objectName;j.finals.dimension.objectNameMap[p.id]=p}}if(n.user&&n.user.ouc){k.prototype.array.sort(n.user.ouc)}}());return{conf:j,api:l,support:k,service:h,web:i,init:n}};var c=".dv-chart-tips { border-radius: 2px; padding: 0px 3px 1px; border: 2px solid #000; background-color: #000; } \n";c+=".dv-chart-tips .x-tip-body { background-color: #000; font-size: 13px; font-weight: normal; color: #fff; -webkit-text-stroke: 0; } \n";c+=".dv-chart-tips .x-tip-body div { font-family: arial,sans-serif,ubuntu,consolas !important; } \n";c+=".x-mask-msg { padding: 0; border: 0 none; background-image: none; background-color: transparent; } \n";c+=".x-mask-msg div { background-position: 11px center; } \n";c+=".x-mask-msg .x-mask-loading { border: 0 none; \n background-color: #000; color: #fff; border-radius: 2px; padding: 12px 14px 12px 30px; opacity: 0.65; } \n";c+=".x-mask { opacity: 0; } \n";Ext.util.CSS.createStyleSheet(c);EV.plugin={};var f={user:{},systemInfo:{}},e=[],g=false,b=false,a,d;a=function(j){var n=false,m=[],h=0,l;f.contextPath=j;l=function(){if(++h===m.length){b=true;for(var o=0;o<e.length;o++){d(e[o])}e=[]}};m.push({url:j+"/api/systemSettings.jsonp?key=keyCalendar&key=keyDateFormat",success:function(o){var i=o;f.systemInfo.dateFormat=Ext.isString(i.keyDateFormat)?i.keyDateFormat.toLowerCase():"yyyy-mm-dd";f.systemInfo.calendar=i.keyCalendar;Ext.data.JsonP.request({url:j+"/api/me/user-account.jsonp",success:function(p){f.userAccount=p;Ext.Loader.injectScriptElement(j+"/dhis-web-commons/javascripts/jQuery/jquery.min.js",function(){Ext.Loader.injectScriptElement(j+"/dhis-web-commons/javascripts/dhis2/dhis2.util.js",function(){Ext.Loader.injectScriptElement(j+"/dhis-web-commons/javascripts/dhis2/dhis2.storage.js",function(){Ext.Loader.injectScriptElement(j+"/dhis-web-commons/javascripts/dhis2/dhis2.storage.idb.js",function(){Ext.Loader.injectScriptElement(j+"/dhis-web-commons/javascripts/dhis2/dhis2.storage.ss.js",function(){Ext.Loader.injectScriptElement(j+"/dhis-web-commons/javascripts/dhis2/dhis2.storage.memory.js",function(){var v="en",t="name",s,u,r,q;f.userAccount.settings.keyUiLocale=f.userAccount.settings.keyUiLocale||v;f.userAccount.settings.keyAnalysisDisplayProperty=f.userAccount.settings.keyAnalysisDisplayProperty||t;u=f.contextPath;r=f.userAccount.settings.keyUiLocale;keyAnalysisDisplayProperty=f.userAccount.settings.keyAnalysisDisplayProperty;s=keyAnalysisDisplayProperty===t?keyAnalysisDisplayProperty:keyAnalysisDisplayProperty+"|rename("+t+")";q=f.systemInfo.dateFormat;f.namePropertyUrl=s;dhis2.util.namespace("dhis2.ev");dhis2.ev.store=dhis2.ev.store||new dhis2.storage.Store({name:"dhis2",adapters:[dhis2.storage.IndexedDBAdapter,dhis2.storage.DomSessionStorageAdapter,dhis2.storage.InMemoryAdapter],objectStores:["optionSets"]});Ext.data.JsonP.request({url:u+"/api/optionSets.jsonp?fields=id,version&paging=false",success:function(B){var A=B.optionSets||[],w=dhis2.ev.store,y=[],x="",z=0,D,C;C=function(){if(++z===A.length){if(!y.length){l();return}for(var E=0;E<y.length;E++){x+="&filter=id:eq:"+y[E]}Ext.data.JsonP.request({url:u+"/api/optionSets.jsonp?fields=id,name,version,options[code,name]&paging=false"+x,success:function(G){var F=G.optionSets;w.setAll("optionSets",F).done(l)}})}};registerOptionSet=function(E){w.get("optionSets",E.id).done(function(F){if(!Ext.isObject(F)||F.version!==E.version){y.push(E.id)}C()})};w.open().done(function(){for(var E=0;E<A.length;E++){registerOptionSet(A[E])}})}})})})})})})})}})}});m.push({url:j+"/api/organisationUnits.jsonp?userOnly=true&fields=id,name,children[id,name]&paging=false",success:function(s){var q=s.organisationUnits||[],p=[],t=[];if(q.length){for(var o=0,u;o<q.length;o++){u=q[o];p.push(u.id);if(u.children){t=Ext.Array.clean(t.concat(Ext.Array.pluck(u.children,"id")||[]))}}f.user=f.user||{};f.user.ou=p;f.user.ouc=t}else{alert("User is not assigned to any organisation units")}l()}});f.legendSets=[];m.push({url:j+"/api/dimensions.jsonp?links=false&paging=false",success:function(i){f.dimensions=i.dimensions;l()}});for(var k=0;k<m.length;k++){Ext.data.JsonP.request(m[k])}};d=function(k){var m,j,i,h,l={core:{},app:{}};m=function(n){if(!Ext.isObject(n)){console.log("Event report configuration is not an object");return}if(!Ext.isString(n.el)){console.log("No valid element id provided");return}n.id=n.id||n.uid;return true};j=function(s){var u=s.core.init,p=s.core.conf,r=s.core.api,q=s.core.support,n=s.core.service,o=s.core.web,t=p.finals.dimension;u.el=k.el;Ext.get(u.el).setStyle("opacity",0);o.report=o.report||{};o.report.loadReport=function(v){if(!Ext.isString(v)){alert("Invalid event report id");return}Ext.data.JsonP.request({url:u.contextPath+"/api/eventCharts/"+v+".jsonp?fields="+p.url.analysisFields.join(","),failure:function(w){window.open(u.contextPath+"/api/eventCharts/"+v+".json?fields="+p.url.analysisFields.join(","),"_blank")},success:function(x){var w=r.layout.Layout(x);if(w){o.report.getData(w,true)}}})};o.report.getData=function(v,w){var x=o.analytics.getParamString(v,"jsonp");o.mask.show(s.app.centerRegion);Ext.data.JsonP.request({url:s.core.init.contextPath+x,disableCaching:false,scope:this,failure:function(y){o.mask.hide(s.app.centerRegion);console.log(y.status+"\n"+y.statusText+"\n"+y.responseText)},success:function(A){var y=r.response.Response(A);if(!y){o.mask.hide(s.app.centerRegion);return}for(var z=0,B=t.objectNameMap,C;z<y.headers.length;z++){C=y.headers[z];B[C.name]=B[C.name]||{id:C.name,dimensionName:C.name,name:C.column}}s.app.paramString=x;o.report.createReport(v,y,w)}})};o.report.createReport=function(B,A,x){var E,G,v,z,D,w,F,y,C;w=function(R,M){var Q=[];for(var J=0;J<R.headers.length;J++){if(Ext.isString(R.headers[J].optionSet)){Q.push(R.headers[J])}}if(Q.length){var L=0,O={},N,P;P=function(){if(++L===Q.length){R.metaData.optionNames=O;M()}};N=function(T,S){dhis2.ev.store.get("optionSets",T).done(function(U){Ext.apply(O,q.prototype.array.getObjectMap(U.options,"code","name",S));P()})};for(var J=0,K,H,I;J<Q.length;J++){K=Q[J];H=K.optionSet;I=K.name;N(H,I)}}else{M()}};F=function(){if(!E){o.mask.hide(s.app.centerRegion);return}D=o.report.aggregate.createChart(B,E,G,s.app.centerRegion);D.on("afterrender",function(){Ext.defer(function(){Ext.get(s.core.init.el).fadeIn({duration:400})},300)});s.app.centerRegion.removeAll();s.app.centerRegion.add(D);s.app.layout=B;s.app.xLayout=E;s.app.response=A;s.app.xResponse=G;s.app.chart=D;o.mask.hide(s.app.centerRegion);if(EV.isDebug){console.log("layout",B);console.log("response",A);console.log("xResponse",G);console.log("xLayout",E);console.log("core",s.core);console.log("app",s.app)}};y=function(){E=n.layout.getSyncronizedXLayout(B,E,G);F()};C=function(){E=n.layout.getExtendedLayout(B);G=n.response.aggregate.getExtendedResponse(E,A);w(G,y)};A=A||s.app.response;C()}};i=function(){var s=Ext.get(l.core.init.el),u,o=parseInt(s.getStyle("border-left-width"))+parseInt(s.getStyle("border-right-width")),q=parseInt(s.getStyle("border-top-width"))+parseInt(s.getStyle("border-bottom-width")),t=parseInt(s.getStyle("padding-left"))+parseInt(s.getStyle("padding-right")),p=parseInt(s.getStyle("padding-top"))+parseInt(s.getStyle("padding-bottom")),r=s.getWidth()-o-t,n=s.getHeight()-q-p;u=Ext.create("Ext.panel.Panel",{renderTo:s,bodyStyle:"border: 0 none",width:k.width||r,height:k.height||n,layout:"fit"});return{centerRegion:u}};h=function(){if(!m(k)){return}l.core=EV.getCore(Ext.clone(f));l.core.init.el=k.el;Ext.get(l.core.init.el).setStyle("opacity",0);j(l);l.app.viewport=i();l.app.centerRegion=l.app.viewport.centerRegion;if(k.id){l.core.web.report.loadReport(k.id)}else{layout=l.core.api.layout.Layout(k);if(!layout){return}l.core.web.report.getData(layout)}}()};EV.plugin.getEventChart=function(h){if(Ext.isString(h.url)&&h.url.split("").pop()==="/"){h.url=h.url.substr(0,h.url.length-1)}if(b){d(h)}else{e.push(h);if(!g){g=true;a(h.url)}}};DHIS=Ext.isObject(window.DHIS)?DHIS:{};DHIS.getEventChart=EV.plugin.getEventChart});
